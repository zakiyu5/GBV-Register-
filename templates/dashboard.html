{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-center">GBV Dashboard</h2>

    <!-- Date Filter -->
    <div class="card mb-4">
        <div class="card-body">
            <form class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Start Date</label>
                    <input type="date" class="form-control" name="start_date" value="{{ start_date }}">
                </div>
                <div class="col-md-4">
                    <label class="form-label">End Date</label>
                    <input type="date" class="form-control" name="end_date" value="{{ end_date }}">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="row mb-4">
        <div class="col-md-2">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <h3>{{ total_cases }}</h3>
                    <p>Total Cases</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-info text-white">
                <div class="card-body">
                    <h3>{{ female_pct }}%</h3>
                    <p>Female Survivors</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-warning text-white">
                <div class="card-body">
                    <h3>{{ minors_pct }}%</h3>
                    <p>Children (&lt;18)</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <h3>{{ pep_pct }}%</h3>
                    <p>Received PEP</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-secondary text-white">
                <div class="card-body">
                    <h3>{{ referred_pct }}%</h3>
                    <p>Referred for Support</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Cases Over Time</div>
                <div class="card-body">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">Type of Violence</div>
                <div class="card-body">
                    <canvas id="violenceChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header">Age Distribution</div>
                <div class="card-body">
                    <canvas id="ageChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center">
        <a href="/" class="btn btn-outline-primary">Data Entry</a>
        <a href="/records" class="btn btn-outline-secondary ms-2">All Records</a>
        <a href="/reports" class="btn btn-outline-info ms-2">Reports</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const chartData = {{ chart_data | safe }};

    new Chart(document.getElementById('timeChart'), {
        type: 'line',
        data: {
            labels: chartData.time.labels,
            datasets: [{
                label: 'GBV Cases',
                data: chartData.time.values,
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                tension: 0.3
            }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
    });

    new Chart(document.getElementById('violenceChart'), {
        type: 'pie',
        data: {
            labels: chartData.violence.labels,
            datasets: [{
                data: chartData.violence.values,
                backgroundColor: ['#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff']
            }]
        },
        options: { responsive: true }
    });

    new Chart(document.getElementById('ageChart'), {
        type: 'bar',
        data: {
            labels: chartData.age.labels,
            datasets: [{
                label: 'Cases',
                data: chartData.age.values,
                backgroundColor: '#198754'
            }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });
</script>
{% endblock %}